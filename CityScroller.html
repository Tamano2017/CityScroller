<html>
  <head>
    <title>CityScroller</title>
    <script src="http://cloud.github.com/downloads/processing-js/processing-js/processing-1.4.1.min.js"></script>
    <script type="text/processing" data-processing-target="mycanvas">
        // Declare and contruct two objects (h1, h2) from the class HorizontalLine 
        
        // Declare and contruct two objects (h1, h2) from the class HorizontalLine
        
        int WINDOW_WIDTH = 1240;
        int WINDOW_HEIGHT = 650;
        int RIGHT_ARROW = 39;
        int LEFT_ARROW = 37;
        Skyline slowSkyline = new Skyline(1,50,150,20);
        Skyline fastSkyline = new Skyline(2,160,250,50);
        Skyline prettyFastSkyline = new Skyline(4,260,350,80);  
        Mario readyMario = new Mario(100,100);
      
        int REFRESH_RATEPER_SECOND = 30;
        int GREY = 204;
        //runs once at the start of the program 
        void setup() 
        {
        
          size(WINDOW_WIDTH, WINDOW_HEIGHT);
        
          slowSkyline.addSkyline();
          fastSkyline.addSkyline();
          prettyFastSkyline.addSkyline();
          readyMario.updateAndDrawMario();

        
        }
        
        
        //called repeatedly 
        void draw() { 
        
          background(GREY);

          slowSkyline.drawSkyline();
          if (keyPressed && keyCode == RIGHT_ARROW) {
              slowSkyline.updateAndRefill();
            }
         fastSkyline.drawSkyline();
         if (keyPressed && keyCode == RIGHT_ARROW) {
            fastSkyline.updateAndRefill();
            }
         prettyFastSkyline.drawSkyline();
         if (keyPressed && keyCode == RIGHT_ARROW) {
            prettyFastSkyline.updateAndRefill();
            }
      
      


          
        } 
        
        class tower{
        var tX, tY, tW, tS;

        tower(var towerX, towerY, towerW, towerS){
        tX = towerX;
        tY = towerY;
        tW = towerW;
        tS = towerS;
        }
        void drawTower(){
        rect(tX+tW/4, tY-30, tW/2, 30);
        rect(tX+tW/2.1, tY-70, 5,40);
        }
        void update(){
        tX-=tS;
        }
        int gettX(){
        return tX;
          }

        }
        
        class Building { 
          
          //attributes
          float By, Bx, Bw, s, c; 
        
          //constructor 
          Building(int BuildingY, float BuildingX, float BuildingW, float speed, float color) {  
        
            By = BuildingY; 
        
            Bx = BuildingX; 

            Bw = BuildingW;

            s = speed;

            c = color;

          } 
          
          
          void drawBuilding() 
          {
          fill(c,c,c);
          rect(Bx, By, Bw, height-By);
      }

          void update(){
          Bx-=s;
          }
          int getBx(){
          return Bx;
          }
          int getBy(){
          returnBy;
          }

        
        }

        class Skyline{
          var xPos;
          ArrayList<Building> BuildingList; 
          ArrayList<Tower> TowerList;
          var bw;
          float SkyS;
          float UpperLimit;
          float LowerLimit;
          float Sc;
          float i;
          var Y;
          var last;
    
          Skyline(float SkySpeed, float LowL, float UpL, float SkylineColor) {  
            xPos = 0;
            tPos = 0;
            SkyS = SkySpeed;
            UpperLimit = UpL;
            LowerLimit = LowL;
            Sc = SkylineColor;
            bw = 0;
            Y = 0;
            last = 0;
            BuildingList = new ArrayList<Building>();
            TowerList = new ArrayList<Tower>();
          }
          void addTower(){
          TowerList.add(new tower(xPos,Y,bw,SkyS));
          }
          void addBuilding() 
            { 
              bw = random(50,150);
              Y = random(LowerLimit,UpperLimit);
              BuildingList.add(new Building(Y,xPos,bw,SkyS,Sc));
              addTower();
              xPos += bw + 2;

            } 
          void addSkyline(){
            while (xPos < width){
            addBuilding();
            }
            }

            void drawSkyline(){
            for(var z = 0; z < BuildingList.size(); z++) {
              Building currentBuilding = BuildingList.get(z);
              currentBuilding.drawBuilding();
            }
            for(var h = 0; h < TowerList.size(); h++){
            tower currenttower = TowerList.get(h);
            currenttower.drawTower();
            }
          
          }

          void updateAndRefill(){
          for(var b = 0; b < BuildingList.size(); b++) {
              Building currentBuilding = BuildingList.get(b);
              currentBuilding.update();
              }
          for(var h = 0; h < TowerList.size(); h++) {
              tower currenttower = TowerList.get(h);
              currenttower.update();
              }
          Building firstBuilding = BuildingList.get(0);
          if(firstBuilding.getBx() <= -200){
          BuildingList.remove(0);
          TowerList.remove(0);
            }
          int last = BuildingList.size();
          Building lastBuilding = BuildingList.get(7);
          if(lastBuilding.getBx() <= width + 300){
          addBuilding();
          }
          }

          }
      class Mario
        {
          //attributes
          var marioX, marioY, coins;
          PImage img;

          //constructor
          Mario(var mX, var mY){
            marioX = mX;
            marioY = mY;
            img = loadImage("frame_0_delay-0.05s.jpg");
            coins = 0;
          }

          void updateAndDrawMario(){
            update();
            drawMario();
          }

          void update(){
            if (keyPressed && keyCode == UP_ARROW) {
              jump();
            }
            else {
              fall();
            }
            
          }

          void drawMario(){ 
            image(img, marioX, marioY,64,64);
          }

          void jump(){
            img = loadImage("frame_1_delay-0.05s.jpg");
            marioY -= 5;
           }

          void fall(){
           if(marioY < height - 75){
              marioY += 5;
            }
           else { //at bottom of screen 
              img = loadImage("frame_0_delay-0.05s.jpg");
            }
          }
        }
        
  
        </script> 
    </head>
    
    <body>
    <canvas id="mycanvas"></canvas>
  </body>
</html>